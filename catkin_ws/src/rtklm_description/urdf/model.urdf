<?xml version="1.0"?>
<robot name="rtklawnmower" xmlns:xacro="http://www.ros.org/wiki/xacro">

  <xacro:property name="chassis_m" value="4"/>
  <xacro:property name="chassis_l" value="0.40"/>
  <xacro:property name="chassis_w" value="0.25"/>
  <xacro:property name="chassis_h" value="0.10"/>
  <xacro:property name="wheel_m" value="0.5"/>
  <xacro:property name="wheel_r" value="0.06"/>
  <xacro:property name="wheel_l" value="0.08"/>
  <xacro:property name="caster_m" value="0.1"/>
  <xacro:property name="caster_r" value="0.04"/>

  <xacro:macro name="inertia_box" params="m l w h">
    <inertial>
      <mass value="${m}"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="${(1/12) * m * (w*w + h*h)}" ixy="0.0" ixz="0.0"
               iyy="${(1/12) * m * (l*l + h*h)}" iyz="0.0"
               izz="${(1/12) * m * (l*l + w*w)}" />
    </inertial>
  </xacro:macro>
  <xacro:macro name="inertia_cylinder" params="m r l">
    <inertial>
      <mass value="${m}"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="${(1/12) * m * (3*r*r + l*l)}" ixy="0.0" ixz="0.0"
               iyy="${(1/12) * m * (3*r*r + l*l)}" iyz="0.0"
               izz="${(1/2)  * m * (r*r)}" />
    </inertial>
  </xacro:macro>
  <xacro:macro name="inertia_sphere" params="m r">
    <inertial>
      <mass value="${m}"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="${(2/5) * m * (r*r)}" ixy="0.0" ixz="0.0"
               iyy="${(2/5) * m * (r*r)}" iyz="0.0"
               izz="${(2/5) * m * (r*r)}" />
    </inertial>
  </xacro:macro>

  <link name="base_footprint">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <box size="0.001 0.001 0.001"/>
      </geometry>
    </visual>
  </link>
  <joint name="base_footprint_joint" type="fixed">
    <origin xyz="0 0 0.06" rpy="0 0 0"/>
    <parent link="base_footprint"/>
    <child link="base_link"/>
  </joint>
  
  <!-- Chassis -->
  <link name="base_link">
    <visual>
      <origin xyz="0.1 0 0.12" rpy="0 0 0"/>
      <geometry>
        <box size="${chassis_l} ${chassis_w} ${chassis_h}"/>
      </geometry>
    </visual>
    <collision>
      <origin xyz="0.1 0 0.12" rpy="0 0 0"/>
      <geometry>
        <box size="${chassis_l} ${chassis_w} ${chassis_h}"/>
      </geometry>
    </collision>
    <xacro:inertia_box m="${chassis_m}" l="${chassis_l}" w="${chassis_w}" h="${chassis_h}"/>
  </link>
  
  <!-- Right wheel -->
  <link name="right_wheel">
    <visual>
      <origin xyz="0 0 0" rpy="${pi/2} 0 0"/>
      <geometry>
        <cylinder radius="${wheel_r}" length="${wheel_l}"/>
      </geometry>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="${pi/2} 0 0"/>
      <geometry>
        <cylinder radius="${wheel_r}" length="${wheel_l}"/>
      </geometry>
    </collision>
    <xacro:inertia_cylinder m="${wheel_m}" r="${wheel_r}" l="${wheel_l}"/>
  </link>
  <joint name="right_wheel_joint" type="continuous">
    <parent link="base_link"/>
    <child link="right_wheel"/>
    <origin xyz="0.0 0.08 0.0" rpy="0 0 0"/>
    <axis rpy="0  0" xyz="0 1 0"/>
  </joint>
  <transmission name="right_wheel_joint_transmission">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="right_wheel_joint">
      <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
	</joint>
    <actuator name="right_wheel_joint_motor">
      <hardwareInterface>VelocityJointInterface</hardwareInterface>
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>
  
  <!-- Left wheel -->
  <link name="left_wheel">
    <visual>
      <origin xyz="0 0 0" rpy="${pi/2} 0 0"/>
      <geometry>
        <cylinder radius="${wheel_r}" length="${wheel_l}"/>
      </geometry>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="${pi/2} 0 0"/>
      <geometry>
        <cylinder radius="${wheel_r}" length="${wheel_l}"/>
      </geometry>
    </collision>
    <xacro:inertia_cylinder m="${wheel_m}" r="${wheel_r}" l="${wheel_l}"/>
  </link>
  <joint name="left_wheel_joint" type="continuous">
    <parent link="base_link"/>
    <child link="left_wheel"/>
    <origin xyz="0.0 -0.08 0.0" rpy="0 0 0" />
    <axis rpy="0  0" xyz="0 1 0"/>
  </joint>
  <transmission name="left_wheel_joint_transmission">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="left_wheel_joint">
      <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
	</joint>
    <actuator name="left_wheel_joint_motor">
      <hardwareInterface>VelocityJointInterface</hardwareInterface>
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>

  <!--Right caster -->
  <link name="right_caster">
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <sphere radius="${caster_r}"/>
      </geometry>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <sphere radius="${caster_r}"/>
      </geometry>
    </collision>
    <xacro:inertia_sphere m="${caster_m}" r="${caster_r}"/>
  </link>
  <joint name="caster_right_joint" type="fixed">
    <parent link="base_link"/>
    <child link="right_caster"/>
    <origin xyz="0.25 0.1 -0.01" rpy="0 0 0"/>
  </joint>

  <!-- Left caster -->
  <link name="left_caster">
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <sphere radius="${caster_r}"/>
      </geometry>
    </visual>
    <collision>
      <geometry>
        <sphere radius="${caster_r}"/>
      </geometry>
      <origin xyz="0 0 0" rpy="0 0 0"/>
    </collision>
    <xacro:inertia_sphere m="${caster_m}" r="${caster_r}"/>
  </link>
  <joint name="caster_left_joint" type="fixed">
    <parent link="base_link"/>
    <child link="left_caster"/>
    <origin xyz="0.25 -0.1 -0.01" rpy="0 0 0"/>
  </joint>
  
  <gazebo>
    <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so">
	  </plugin>
  </gazebo>

</robot>